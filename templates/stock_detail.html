{% extends 'base.html' %}
{% load static %}

{% block additional_css %}
{% endblock %}

{% block content %}

    <!--**********************************
        Content body start
    ***********************************-->
    <div class="content-body">
        <!-- row -->
        <div class="container-fluid">

            {#            <div class="row">#}
            {#                <div class="previews-info-list">#}
            {#                    <div class="ms-2">#}
            {#                        <h1 class="mb-0">{{ stock.stock_name }}</h1>#}
            {#                    </div>#}
            {#                </div>#}
            {##}
            {#            </div>#}
            <!-- Row -->
            <div class="row">

                {% include 'elements/nav-tool.html' %}

                <div class="col-xl-12">
                    <div class="tab-content" id="nav-tabContent">
                        <div class="tab-pane fade show active" id="nav-bitcoin" role="tabpanel">
                            <div class="row">
                                <!-- 图表 -->
                                <div class="col-xl-12">
                                    <div class="card coin-content">
                                        <div class="card-header border-0 flex-wrap pb-0">
                                            <div class="mb-xl-0 mb-2">
                                                <h2 class="mb-0">{{ stock.symbol }}</h2>
                                            </div>

                                        </div>
                                        <div class="card-body">
                                            <div class="d-flex align-items-center justify-content-between flex-wrap">
                                                <div class="d-flex align-items-end justify-content-between flex-wrap">
                                                    <div class="price-content">
                                                        <span class="d-block mb-2">current</span>
                                                        <h4 class="fs-20 font-w600 mb-0 current_price_number">
                                                            ${{ stock.get_current_price }}</h4>
                                                    </div>
                                                    <div class="price-content">

                                                        {% if stock.change_extent > 0 %}
                                                            <span class="fs-14 d-block mb-2">24h% change</span>
                                                            <h4 class="font-w600 text-success mb-0">{{ stock.get_change_extent | floatformat:2 }}%<i
                                                                    class="fa-solid fa-caret-up ms-1 text-success"></i>
                                                            </h4>
                                                        {% else %}
                                                            <span class="fs-14 d-block mb-2">24h% change</span>
                                                            <h4 class="font-w600 text-danger mb-0">{{ stock.get_change_extent | floatformat:2 }}%<i
                                                                    class="fa-solid fa-caret-down ms-1 text-danger"></i>
                                                            </h4>
                                                        {% endif %}


                                                    </div>
                                                    <div class="price-content">
                                                        <span class="fs-14 d-block mb-2">open</span>
                                                        <h4 class="font-w600 mb-0 text-danger">{{ stock.get_open_price | floatformat:2 }}</h4>
                                                    </div>
                                                    <div class="price-content">
                                                        <span class="fs-14 d-block mb-2">company</span>
                                                        <h4 class="font-w600 mb-0 text-primary">{{ stock.get_company_name }}</h4>
                                                    </div>
                                                    <div class="price-content">
                                                        <span class="fs-14 d-block mb-2">exchangeName</span>
                                                        <h4 class="font-w600 mb-0">{{ stock.exchangeName }}</h4>
                                                    </div>
                                                    <div class="price-content">
                                                        <span class="fs-14 d-block mb-2">regularMarketPrice</span>
                                                        <h4 class="font-w600 mb-0 text-warning">
                                                            ${{ stock.regularMarketPrice }}</h4>
                                                    </div>
                                                </div>

                                            </div>

                                            <div id="stockhChart"></div>

                                            <div class="col-xs-12">
                                                <ul class="nav nav-pills">
                                                    <li class=" nav-item">
                                                        <a href="#navpills-1" class="nav-link active"
                                                           data-bs-toggle="tab" aria-expanded="false">1D</a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="#navpills-2" class="nav-link " data-bs-toggle="tab"
                                                           aria-expanded="false">5D</a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="#navpills-3" class="nav-link" data-bs-toggle="tab"
                                                           aria-expanded="true">1M</a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a href="#navpills-5" class="nav-link" data-bs-toggle="tab"
                                                           aria-expanded="true">5M</a>
                                                    </li>

                                                </ul>
                                            </div>

                                        </div>
                                    </div>
                                </div>


                                <!-- 交易表格 -->
                                <div class="col-xl-6 col-sm-6">
                                    <div class="card">
                                        <div class="card-header flex-wrap border-0">
                                            <ul class=" nav nav-pills light" id="pills-tab" role="tablist">
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link active" id="pills-crypto-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-crypto" type="button" role="tab"
                                                            aria-controls="pills-crypto" aria-selected="true">
                                                        Company

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link" id="pills-spot-tab" data-bs-toggle="pill"
                                                            data-bs-target="#pills-spot" type="button" role="tab"
                                                            aria-controls="pills-spot" aria-selected="false">
                                                        News

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link" id="pills-future-tab" data-bs-toggle="pill"
                                                            data-bs-target="#pills-future" type="button" role="tab"
                                                            aria-controls="pills-future" aria-selected="false">
                                                        Income

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link me-0" id="pills-listing-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-listing-2" type="button" role="tab"
                                                            aria-controls="pills-listing-2" aria-selected="false">
                                                        Balance

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link me-0" id="pills-listing-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-listing-3" type="button" role="tab"
                                                            aria-controls="pills-listing-3" aria-selected="false">
                                                        Quarterly balance

                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="card-body pt-0">
                                            <div class="tab-content" id="pills-tabContent">
                                                <div class="tab-pane fade show active" id="pills-crypto" role="tabpanel"
                                                     aria-labelledby="pills-crypto-tab">
                                                    <div class="table-responsive">
                                                        <table class="table">

                                                            <tbody>
                                                            <tr>
                                                                <td>
                                                                    <div class="ms-3">
                                                                        <h5 class="mb-0"><a
                                                                                href="#">address</a></h5>
                                                                    </div>
                                                                </td>
                                                                <td>{{ company_info.address1 }}</td>
                                                                <td>
                                                                    <div class="ms-3">
                                                                        <h5 class="mb-0"><a
                                                                                href="#">city</a></h5>
                                                                    </div>
                                                                </td>
                                                                <td>{{ company_info.city }}</td>

                                                            </tr>

                                                            <tr>
                                                                <td>
                                                                    <div class="ms-3">
                                                                        <h5 class="mb-0"><a
                                                                                href="#">country</a></h5>
                                                                    </div>
                                                                </td>
                                                                <td>{{ company_info.country }}</td>

                                                                <td>
                                                                    <div class="ms-3">
                                                                        <h5 class="mb-0"><a
                                                                                href="#">website</a></h5>
                                                                    </div>
                                                                </td>
                                                                <td><a class="btn tp-btn-light btn-secondary"
                                                                       target="_blank"
                                                                       href="{{ company_info.website }}">{{ company_info.website }}</a>
                                                                </td>

                                                            </tr>

                                                            </tbody>
                                                        </table>

                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="pills-spot" role="tabpanel"
                                                     aria-labelledby="pills-spot-tab">
                                                    <div class="table-responsive">
                                                        <table class="table">

                                                            <tbody>
                                                            {% for new in news %}
                                                                <tr>
                                                                    <td>
                                                                        <div class="ms-3">
                                                                            <h5 class="mb-0"><a class="link-primary"
                                                                                                href="{{ new.link }}">{{ new.title }}</a>
                                                                            </h5>
                                                                        </div>
                                                                    </td>
                                                                    <td>{{ new.providerPublishTime }}</td>

                                                                </tr>
                                                            {% endfor %}


                                                            </tbody>
                                                        </table>

                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="pills-future" role="tabpanel"
                                                     aria-labelledby="pills-future-tab">
                                                    <div class="table-responsive">
                                                        {{ income_statement|safe }}

                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="pills-listing" role="tabpanel"
                                                     aria-labelledby="pills-listing-tab">
                                                    <div class="table-responsive">
                                                        {{ quarterly_income_statement|safe }}

                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="pills-listing-2" role="tabpanel"
                                                     aria-labelledby="pills-listing-tab">
                                                    <div class="table-responsive">
                                                        {{ balance_sheet|safe }}

                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="pills-listinG-3" role="tabpanel"
                                                     aria-labelledby="pills-listing-tab">
                                                    <div class="table-responsive">
                                                        {{ quarterly_balance_sheet|safe }}

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-6 col-sm-6">
                                    <div class="card">
                                        <div class="card-header flex-wrap border-0">
                                            <ul class=" nav nav-pills light" id="pills-tab" role="tablist">
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link " id="pills-crypto-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-crypto-1" type="button" role="tab"
                                                            aria-controls="pills-crypto-1" aria-selected="true">cashflow

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link " id="pills-crypto-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-crypto-2" type="button" role="tab"
                                                            aria-controls="pills-crypto-2" aria-selected="true">
                                                        quarterly_cashflow

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link active" id="pills-crypto-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-crypto-3" type="button" role="tab"
                                                            aria-controls="pills-crypto-3" aria-selected="true">
                                                        recommendations

                                                    </button>
                                                </li>
                                                <li class="nav-item my-1" role="presentation">
                                                    <button class="nav-link " id="pills-crypto-tab"
                                                            data-bs-toggle="pill"
                                                            data-bs-target="#pills-crypto-4" type="button" role="tab"
                                                            aria-controls="pills-crypto-4" aria-selected="true">
                                                        recommendations_summary

                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="card-body pt-0">
                                            <div class="tab-content" id="pills-tabContent">
                                                <div class="tab-pane fade show " id="pills-crypto-1"
                                                     role="tabpanel"
                                                     aria-labelledby="pills-crypto-tab">
                                                    <div class="table-responsive">
                                                        {{ cashflow|safe }}
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade show " id="pills-crypto-2" role="tabpanel"
                                                     aria-labelledby="pills-crypto-tab">
                                                    <div class="table-responsive">
                                                        {{ quarterly_cashflow|safe }}
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade show active" id="pills-crypto-3" role="tabpanel"
                                                     aria-labelledby="pills-crypto-tab">
                                                    <div class="table-responsive">
                                                        {{ recommendations|safe }}
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade show " id="pills-crypto-4" role="tabpanel"
                                                     aria-labelledby="pills-crypto-tab">
                                                    <div class="table-responsive">
                                                        {{ recommendations_summary|safe }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>


                {% if current_user %}
                    <div class="col-xl-12">
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-bitcoin" role="tabpanel">
                                <div class="row">


                                    <div class="col-xl-6 col-sm-12">
                                        <div class="card quick-trade">
                                            <div class="card-header pb-0 border-0 flex-wrap">
                                                <div>
                                                    <h4 class="card-title">{{ stock.symbol }} &nbsp; </h4>
                                                    <p class="mb-xl-0 mb-3 fs-12 current_price_number"> {{ stock.get_current_price }}</p>
                                                </div>
                                            </div>
                                            <div class="card-body pb-0">
                                                <div class="basic-form">
                                                    <form action="{% url 'financial_system:sell_stock' %}" method="post"
                                                          class="form-wrapper trade-form">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="symbol"
                                                               value="{{ stock.symbol }}">
                                                        <div class="input-group mb-3 ">
                                                            <span class="input-group-text">PRICE</span>
                                                            <input class="form-control form-control text-end current_price_number"
                                                                   readonly="readonly" type="text"
                                                                   value="{{ stock.get_current_price }}"
                                                                   placeholder="0,000000">
                                                        </div>
                                                        <div class="input-group mb-3 ">
                                                            <span class="input-group-text">Quantity</span>
                                                            <input name="quantity"
                                                                   class="form-control form-control text-end"
                                                                   type="number"
                                                                   placeholder="0,000000">
                                                        </div>

                                                        <div class="input-group mb-3 ">
                                                            <button type="submit"
                                                                    class="btn d-flex  btn-success justify-content-between align-items-center w-100">
                                                                BUY
                                                                <svg width="16" height="16" viewBox="0 0 21 21"
                                                                     fill="none"
                                                                     xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="M16.9638 11.5104L16.9721 14.9391L3.78954 1.7565C3.22815 1.19511 2.31799 1.19511 1.75661 1.7565C1.19522 2.31789 1.19522 3.22805 1.75661 3.78943L14.9392 16.972L11.5105 16.9637L11.5105 16.9637C10.7166 16.9619 10.0715 17.6039 10.0696 18.3978C10.0677 19.1919 10.7099 19.8369 11.5036 19.8388L11.5049 19.3388L11.5036 19.8388L18.3976 19.8554L18.4146 19.8555L18.4159 19.8555C18.418 19.8555 18.42 19.8555 18.422 19.8555C19.2131 19.8533 19.8528 19.2114 19.8555 18.4231C19.8556 18.4196 19.8556 18.4158 19.8556 18.4117L19.8389 11.5035L19.8389 11.5035C19.8369 10.7097 19.1919 10.0676 18.3979 10.0695C17.604 10.0713 16.9619 10.7164 16.9638 11.5103L16.9638 11.5104Z"
                                                                          fill="white" stroke="white"></path>
                                                                </svg>
                                                            </button>
                                                        </div>

                                                    </form>
                                                </div>
                                            </div>

                                        </div>
                                    </div>


                                    {#                                <div class="col-xl-6 col-sm-12">#}
                                    {#                                    <div class="card price-list">#}
                                    {#                                        <div class="card-header border-0 p-3">#}
                                    {#                                            <div>#}
                                    {#                                                <h4 class="text-primary card-title">Buy 5</h4>#}
                                    {#                                            </div>#}
                                    {#                                        </div>#}
                                    {#                                        <div class="card-body px-3 py-0">#}
                                    {#                                            <div class="table-responsive">#}
                                    {#                                                <table class="table text-center bg-primary-hover tr-rounded order-tbl mt-2 ">#}
                                    {#                                                    <thead>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <th class="text-start">Price</th>#}
                                    {#                                                        <th class="text-center">Amount</th>#}
                                    {#                                                        <th class="text-end">Total</th>#}
                                    {#                                                    </tr>#}
                                    {#                                                    </thead>#}
                                    {#                                                    <tbody>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">82.3</td>#}
                                    {#                                                        <td>0.15</td>#}
                                    {#                                                        <td class="text-end">$134,12</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">83.9</td>#}
                                    {#                                                        <td>0.18</td>#}
                                    {#                                                        <td class="text-end">$237,31</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">84.2</td>#}
                                    {#                                                        <td>0.25</td>#}
                                    {#                                                        <td class="text-end">$252,58</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">86.2</td>#}
                                    {#                                                        <td>0.35</td>#}
                                    {#                                                        <td class="text-end">$126,26</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">91.6</td>#}
                                    {#                                                        <td>0.75</td>#}
                                    {#                                                        <td class="text-end">$46,92</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">92.6</td>#}
                                    {#                                                        <td>0.21</td>#}
                                    {#                                                        <td class="text-end">$123,27</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    </tbody>#}
                                    {#                                                </table>#}
                                    {#                                            </div>#}
                                    {#                                        </div>#}
                                    {#                                    </div>#}
                                    {#                                </div>#}


                                    <div class="col-xl-6 col-sm-12">
                                        <div class="card quick-trade">
                                            <div class="card-header pb-0 border-0 flex-wrap">
                                                <div>
                                                    <h4 class="card-title">{{ stock.symbol }} &nbsp; </h4>
                                                    <p class="mb-xl-0 mb-3 fs-12"> {{ stock.get_current_price }}</p>
                                                </div>
                                            </div>
                                            <div class="card-body pb-0">
                                                <div class="basic-form">
                                                    <form action="{% url 'financial_system:sell_stock' %}" method="post"
                                                          class="form-wrapper trade-form">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="symbol"
                                                               value="{{ stock.symbol }}">
                                                        <!-- Same assumption as above -->

                                                        <div class="input-group mb-3 ">
                                                            <span class="input-group-text">PRICE</span>
                                                            <input class="form-control form-control text-end current_price_number"
                                                                   readonly="readonly" type="text"
                                                                   value="{{ stock.get_current_price }}"
                                                                   placeholder="0,000000">
                                                        </div>
                                                        <div class="input-group mb-3 ">
                                                            <span class="input-group-text">Quantity</span>
                                                            <input name="quantity"
                                                                   class="form-control form-control text-end"
                                                                   type="number"
                                                                   placeholder="0,000000">
                                                        </div>

                                                        <div class="input-group mb-3 ">
                                                            <a href="javascript:void(0);"
                                                               class="btn d-flex  btn-danger align-items-center justify-content-between w-100">
                                                                SELL
                                                                <svg class="scale3" width="16" height="16"
                                                                     viewBox="0 0 29 29"
                                                                     fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="M5.35182 13.4965L5.35182 13.4965L5.33512 6.58823C5.33508 6.5844 5.3351 6.58084 5.33514 6.57759M5.35182 13.4965L5.83514 6.58306L5.33514 6.58221C5.33517 6.56908 5.33572 6.55882 5.33597 6.5545L5.33606 6.55298C5.33585 6.55628 5.33533 6.56514 5.33516 6.57648C5.33515 6.57684 5.33514 6.57721 5.33514 6.57759M5.35182 13.4965C5.35375 14.2903 5.99878 14.9324 6.79278 14.9305C7.58669 14.9287 8.22874 14.2836 8.22686 13.4897L8.22686 13.4896L8.21853 10.0609M5.35182 13.4965L8.21853 10.0609M5.33514 6.57759C5.33752 5.789 5.97736 5.14667 6.76872 5.14454C6.77041 5.14452 6.77217 5.14451 6.77397 5.14451L6.77603 5.1445L6.79319 5.14456L13.687 5.16121L13.6858 5.66121L13.687 5.16121C14.4807 5.16314 15.123 5.80809 15.1211 6.6022C15.1192 7.3961 14.4741 8.03814 13.6802 8.03626L13.6802 8.03626L10.2515 8.02798L23.4341 21.2106C23.9955 21.772 23.9955 22.6821 23.4341 23.2435C22.8727 23.8049 21.9625 23.8049 21.4011 23.2435L8.21853 10.0609M5.33514 6.57759C5.33513 6.57959 5.33514 6.58159 5.33514 6.5836L8.21853 10.0609M6.77407 5.14454C6.77472 5.14454 6.77537 5.14454 6.77603 5.14454L6.77407 5.14454Z"
                                                                          fill="white" stroke="white"></path>
                                                                </svg>
                                                            </a>
                                                        </div>

                                                    </form>
                                                </div>
                                            </div>

                                        </div>
                                    </div>


                                    {#                                <div class="col-xl-6 col-sm-12">#}
                                    {#                                    <div class="card price-list">#}
                                    {#                                        <div class="card-header border-0 p-3">#}
                                    {#                                            <div>#}
                                    {#                                                <h4 class="card-title text-danger">Sell 5</h4>#}
                                    {#                                            </div>#}
                                    {#                                        </div>#}
                                    {#                                        <div class="card-body p-3 py-0">#}
                                    {#                                            <div class="table-responsive">#}
                                    {#                                                <table class="table text-center bg-warning-hover tr-rounded order-tbl mt-2">#}
                                    {#                                                    <thead>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <th class="text-start">Price</th>#}
                                    {#                                                        <th class="text-center">Amount</th>#}
                                    {#                                                        <th class="text-end">Total</th>#}
                                    {#                                                    </tr>#}
                                    {#                                                    </thead>#}
                                    {#                                                    <tbody>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">82.3</td>#}
                                    {#                                                        <td>0.15</td>#}
                                    {#                                                        <td class="text-end">$134,12</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">83.9</td>#}
                                    {#                                                        <td>0.18</td>#}
                                    {#                                                        <td class="text-end">$237,31</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">84.2</td>#}
                                    {#                                                        <td>0.25</td>#}
                                    {#                                                        <td class="text-end">$252,58</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">86.2</td>#}
                                    {#                                                        <td>0.35</td>#}
                                    {#                                                        <td class="text-end">$126,26</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">91.6</td>#}
                                    {#                                                        <td>0.75</td>#}
                                    {#                                                        <td class="text-end">$46,92</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    <tr>#}
                                    {#                                                        <td class="text-start">92.6</td>#}
                                    {#                                                        <td>0.21</td>#}
                                    {#                                                        <td class="text-end">$123,27</td>#}
                                    {#                                                    </tr>#}
                                    {#                                                    </tbody>#}
                                    {#                                                </table>#}
                                    {#                                            </div>#}
                                    {#                                        </div>#}
                                    {#                                    </div>#}
                                    {#                                </div>#}


                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- 评论区-->
                <div class="col-xl-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="profile-news">
                                <h5 class="text-primary d-inline">Latest Comments</h5>
                                {% for comment in comments %}
                                    <div class="media pt-3 pb-3">
                                        <div class="media-body">
                                            <h5 class="m-b-5"><a href="#"
                                                                 class="text-dark">Title:{{ comment.title }}</a>
                                            </h5>
                                            <p class="mb-0">Content:{{ comment.content }}</p>
                                            <small>By: {{ comment.user_id.username }}
                                                at {{ comment.comment_time }}</small>
                                        </div>
                                        <div class="media-action">
                                            <button type="button" comment_id="{{ comment.comment_id }}"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#exampleModal1"
                                                    class="reply-btn btn tp-btn-light btn-secondary">Reply
                                            </button>
                                        </div>
                                    </div>
                                {% empty %}
                                    <h4>No comments yet.</h4>
                                {% endfor %}

                            </div>
                        </div>
                    </div>
                </div>
                <!-- 评论区 end-->
                <!-- 发布评论-->
                {% if current_user %}
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="profile-news">
                                    <div class="comment-respond" id="respond">
                                        <h4 class="comment-reply-title text-primary mb-3" id="reply-title">Leave a
                                            Comment </h4>
                                        <form class="comment-form"
                                              action="{{ add_comment_url }}"
                                              method="post">
                                            {% csrf_token %}
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="mb-3">
                                                        <label for="author"
                                                               class="text-dark font-w600 form-label required">Title</label>
                                                        <input type="text" class="form-control" value="Author"
                                                               name="title"
                                                               placeholder="Author" id="author" required>
                                                    </div>
                                                </div>

                                                <div class="col-lg-12">
                                                    <div class="mb-3">
                                                        <label for="comment"
                                                               class="text-dark font-w600 form-label">Comment</label>
                                                        <textarea rows="5" class="form-control" name="content"
                                                                  placeholder="Comment" id="content"
                                                                  required></textarea>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12">
                                                    <div class="mb-3">
                                                        <input type="submit" value="Post Comment"
                                                               class="submit btn btn-primary" id="submit" name="submit">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- 回复 -->
                <div class="modal fade" id="exampleModal1" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <form method="post" action="{% url 'financial_system:add_reply' %}">
                                {% csrf_token %}
                                <div class="modal-header ">
                                    <h5 class="modal-title">Reply</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                </div>

                                <input type="hidden" id="comment_id_input" class="form-control mb-3" name="comment_id"
                                       value="">

                                <div class="modal-body">

                                    <label class="form-label">Content</label>
                                    <input type="text" class="form-control mb-3" id="content" name="content"
                                           placeholder="content">

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger light" data-bs-dismiss="modal">Close
                                    </button>
                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>


                {% csrf_token %}

            </div>
        </div>
    </div>

    <!--**********************************
        Content body end
    ***********************************-->

{% endblock %}

{% block additional_js %}
    <script>
        $(function () {

            //监听回复按钮
            replay_handler()
            setInterval(get_current_price, 3000);


            var start = moment().subtract(29, 'days');
            var end = moment();

            function cb(start, end) {
                $('#reportrange span,#reportrange1 span,#reportrange2 span,#reportrange3 span,#reportrange4 span,#reportrange5 span').html(start.format('D MMMM YYYY') + ' &nbsp - &nbsp ' + end.format('D MMMM YYYY'));
            }

            $('#reportrange , #reportrange1,#reportrange2,#reportrange3,#reportrange4,#reportrange5').daterangepicker({
                startDate: start,
                endDate: end,
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, cb);

            cb(start, end);

            //绘图的js ,数据格式是  时间
            var options = {
                series: [{
                    data: [{
                        x: new Date(1538778600000),
                        y: [6629.81, 6650.5, 6623.04, 6633.33]
                    },
                        {
                            x: new Date(1538780400000),
                            y: [6632.01, 6643.59, 6620, 6630.11]
                        },
                        {
                            x: new Date(1538782200000),
                            y: [6630.71, 6648.95, 6623.34, 6635.65]
                        },
                        {
                            x: new Date(1538784000000),
                            y: [6635.65, 6651, 6629.67, 6638.24]
                        },
                        {
                            x: new Date(1538785800000),
                            y: [6638.24, 6640, 6620, 6624.47]
                        },
                        {
                            x: new Date(1538787600000),
                            y: [6624.53, 6636.03, 6621.68, 6624.31]
                        },
                        {
                            x: new Date(1538789400000),
                            y: [6624.61, 6632.2, 6617, 6626.02]
                        },
                        {
                            x: new Date(1538791200000),
                            y: [6627, 6627.62, 6584.22, 6603.02]
                        },
                        {
                            x: new Date(1538793000000),
                            y: [6605, 6608.03, 6598.95, 6604.01]
                        },
                        {
                            x: new Date(1538794800000),
                            y: [6604.5, 6614.4, 6602.26, 6608.02]
                        },
                        {
                            x: new Date(1538796600000),
                            y: [6608.02, 6610.68, 6601.99, 6608.91]
                        },
                        {
                            x: new Date(1538798400000),
                            y: [6608.91, 6618.99, 6608.01, 6612]
                        },
                        {
                            x: new Date(1538800200000),
                            y: [6612, 6615.13, 6605.09, 6612]
                        },
                        {
                            x: new Date(1538802000000),
                            y: [6612, 6624.12, 6608.43, 6622.95]
                        },
                        {
                            x: new Date(1538803800000),
                            y: [6623.91, 6623.91, 6615, 6615.67]
                        },
                        {
                            x: new Date(1538805600000),
                            y: [6618.69, 6618.74, 6610, 6610.4]
                        },
                        {
                            x: new Date(1538807400000),
                            y: [6611, 6622.78, 6610.4, 6614.9]
                        },
                        {
                            x: new Date(1538809200000),
                            y: [6614.9, 6626.2, 6613.33, 6623.45]
                        },
                        {
                            x: new Date(1538811000000),
                            y: [6623.48, 6627, 6618.38, 6620.35]
                        },
                        {
                            x: new Date(1538812800000),
                            y: [6619.43, 6620.35, 6610.05, 6615.53]
                        },
                        {
                            x: new Date(1538814600000),
                            y: [6615.53, 6617.93, 6610, 6615.19]
                        },
                        {
                            x: new Date(1538816400000),
                            y: [6615.19, 6621.6, 6608.2, 6620]
                        },
                        {
                            x: new Date(1538818200000),
                            y: [6619.54, 6625.17, 6614.15, 6620]
                        },
                        {
                            x: new Date(1538820000000),
                            y: [6620.33, 6634.15, 6617.24, 6624.61]
                        },
                        {
                            x: new Date(1538821800000),
                            y: [6625.95, 6626, 6611.66, 6617.58]
                        },
                        {
                            x: new Date(1538823600000),
                            y: [6619, 6625.97, 6595.27, 6598.86]
                        },
                        {
                            x: new Date(1538825400000),
                            y: [6598.86, 6598.88, 6570, 6587.16]
                        },
                        {
                            x: new Date(1538827200000),
                            y: [6588.86, 6600, 6580, 6593.4]
                        },
                        {
                            x: new Date(1538829000000),
                            y: [6593.99, 6598.89, 6585, 6587.81]
                        },
                        {
                            x: new Date(1538830800000),
                            y: [6587.81, 6592.73, 6567.14, 6578]
                        },
                        {
                            x: new Date(1538832600000),
                            y: [6578.35, 6581.72, 6567.39, 6579]
                        },
                        {
                            x: new Date(1538834400000),
                            y: [6579.38, 6580.92, 6566.77, 6575.96]
                        },
                        {
                            x: new Date(1538836200000),
                            y: [6575.96, 6589, 6571.77, 6588.92]
                        },
                        {
                            x: new Date(1538838000000),
                            y: [6588.92, 6594, 6577.55, 6589.22]
                        },
                        {
                            x: new Date(1538839800000),
                            y: [6589.3, 6598.89, 6589.1, 6596.08]
                        },
                        {
                            x: new Date(1538841600000),
                            y: [6597.5, 6600, 6588.39, 6596.25]
                        },
                        {
                            x: new Date(1538843400000),
                            y: [6598.03, 6600, 6588.73, 6595.97]
                        },
                        {
                            x: new Date(1538845200000),
                            y: [6595.97, 6602.01, 6588.17, 6602]
                        },
                        {
                            x: new Date(1538847000000),
                            y: [6602, 6607, 6596.51, 6599.95]
                        },
                        {
                            x: new Date(1538848800000),
                            y: [6600.63, 6601.21, 6590.39, 6591.02]
                        },
                        {
                            x: new Date(1538850600000),
                            y: [6591.02, 6603.08, 6591, 6591]
                        },
                        {
                            x: new Date(1538852400000),
                            y: [6591, 6601.32, 6585, 6592]
                        },
                        {
                            x: new Date(1538854200000),
                            y: [6593.13, 6596.01, 6590, 6593.34]
                        },
                        {
                            x: new Date(1538856000000),
                            y: [6593.34, 6604.76, 6582.63, 6593.86]
                        },
                        {
                            x: new Date(1538857800000),
                            y: [6593.86, 6604.28, 6586.57, 6600.01]
                        },
                        {
                            x: new Date(1538859600000),
                            y: [6601.81, 6603.21, 6592.78, 6596.25]
                        },
                        {
                            x: new Date(1538861400000),
                            y: [6596.25, 6604.2, 6590, 6602.99]
                        },
                        {
                            x: new Date(1538863200000),
                            y: [6602.99, 6606, 6584.99, 6587.81]
                        },
                        {
                            x: new Date(1538865000000),
                            y: [6587.81, 6595, 6583.27, 6591.96]
                        },
                        {
                            x: new Date(1538866800000),
                            y: [6591.97, 6596.07, 6585, 6588.39]
                        },
                        {
                            x: new Date(1538868600000),
                            y: [6587.6, 6598.21, 6587.6, 6594.27]
                        },
                        {
                            x: new Date(1538870400000),
                            y: [6596.44, 6601, 6590, 6596.55]
                        },
                        {
                            x: new Date(1538872200000),
                            y: [6598.91, 6605, 6596.61, 6600.02]
                        },
                        {
                            x: new Date(1538874000000),
                            y: [6600.55, 6605, 6589.14, 6593.01]
                        },
                        {
                            x: new Date(1538875800000),
                            y: [6593.15, 6605, 6592, 6603.06]
                        },
                        {
                            x: new Date(1538877600000),
                            y: [6603.07, 6604.5, 6599.09, 6603.89]
                        },
                        {
                            x: new Date(1538879400000),
                            y: [6604.44, 6604.44, 6600, 6603.5]
                        },
                        {
                            x: new Date(1538881200000),
                            y: [6603.5, 6603.99, 6597.5, 6603.86]
                        },
                        {
                            x: new Date(1538883000000),
                            y: [6603.85, 6605, 6600, 6604.07]
                        },
                        {
                            x: new Date(1538884800000),
                            y: [6604.98, 6606, 6604.07, 6606]
                        },
                    ]
                }],
                chart: {
                    type: 'candlestick',
                    height: 400,
                    toolbar: {
                        autoSelected: 'pan',
                        show: false
                    },
                    zoom: {
                        enabled: false
                    }
                },
                grid: {
                    show: false,
                },
                plotOptions: {
                    candlestick: {
                        colors: {
                            upward: '#3ab67a',
                            downward: '#fd5353'
                        }
                    }
                },
                title: {
                    text: '',
                    align: 'left'
                },
                xaxis: {
                    type: 'datetime'
                },
                yaxis: {
                    opposite: true,
                    tooltip: {
                        enabled: true
                    }
                }
            };

            var chart = new ApexCharts(document.querySelector("#stockhChart"), options);
            chart.render();

        });

        function replay_handler() {


            // 监听按钮的点击事件
            $(".reply-btn").click(function () {

                // 获取 comment_id 属性的值
                var comment_id = $(this).attr("comment_id");
                console.log("asdasd", comment_id)
                // 将 comment_id 的值设置为输入框的值
                $("#comment_id_input").val(comment_id);
            });

        }

        //定时请求数据
        function get_current_price() {

            var stockSymbol = "{{ stock.symbol }}";
            var csrfToken = $('input[name="csrfmiddlewaretoken"]').val(); // 获取 CSRF 令牌
            $.ajax({
                url: '/stock_current_price/',
                method: 'POST',
                type: "JSON",
                data: {'stock_symbol': stockSymbol, 'csrfmiddlewaretoken': csrfToken},
                success: function (response) {
                    console.log(response);
                    // 在这里处理返回的 JSON 数据
                    $(".current_price_number").html(response['get_current_price'])
                },
                error: function (xhr, status, error) {
                    console.error('Error:', error);
                }
            });

        }

  

    </script>
{% endblock %}